Resources
| where type =~ 'microsoft.compute/virtualmachines'
| where tostring(tags['AppPortID']) == '443'
| project vmId = id, vmName = name, vmRG = resourceGroup, location, AppPortID = tostring(tags['AppPortID'])
| join kind=leftouter (
    Resources
    | where type =~ 'microsoft.compute/disks'
    | where name has 'IdentityDisk'
    | project diskName = name, diskRG = resourceGroup, diskVmId = tostring(properties.ownerId)
) on $left.vmId == $right.diskVmId
| join kind=leftouter (
    Resources
    | where type =~ 'microsoft.network/networkinterfaces'
    | project nicName = name, nicRG = resourceGroup, nicVmId = tostring(properties.virtualMachine.id)
) on $left.vmId == $right.nicVmId
| project vmName, vmRG, location, AppPortID, diskName, diskRG, nicName, nicRG
